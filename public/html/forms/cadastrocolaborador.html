<script>
    document.addEventListener('DOMContentLoaded', () => {
        const nome = sessionStorage.getItem("nome_usuario");
        const nivel = sessionStorage.getItem("nivel_acesso");

        if (!nome || !nivel) {
            window.location.href = "login"; // redireciona para a página de login
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

<div class="cad" style="visibility: visible; opacity: 1;">

    <div class="painel_principal">
        <div class="painel_fundoResumo">
            <div class="painel_resumoColab">
                <div class="painel_foto">
                    <img id="fotoavatar" class="foto avatar" src="/imagens/user-default.webp" alt="Avatar">
                    <div class="statusIcon"></div>
                </div>
                <div class="resumoDados">
                    <span id="nomeCompletoResumo" class="nomeCompleto"></span>
                    <span id="cargoResumo" class="cargo"></span>
                </div>
            </div>
        </div>
        <div class="painel_dadosColab">
            <div class="painel_todos">
                <div class="glass menu_Colab">
                    <a class="bt_menu ativo" data-roles="*" data-target=".painel_perfil">
                        <i class="fa-solid fa-user"></i>
                        <span class="menu-text">Dados Pessoal</span>
                    </a>
                    <a class="bt_menu" data-roles="4,5,6,7,99" data-target=".painel_profissional">
                        <i class="fa-solid fa-house"></i>
                        <span class="menu-text">Dados Profissional</span>
                    </a>
                    <a class="bt_menu" data-roles="4,5,6,7,99" data-target=".painel_exames">
                        <i class="fa-solid fa-suitcase-medical"></i>
                        <span class="menu-text">Exames</span>
                    </a>
                    <a class="bt_menu" data-roles="4,5,6,7,99" data-target=".painel_cursos">
                        <i class="fa-solid fa-graduation-cap"></i>
                        <span class="menu-text">Cursos</span>
                    </a>
                    <a class="bt_menu" data-roles="4,5,6,7,99" data-target=".painel_integra">
                        <i class="fa-solid fa-paperclip"></i>
                        <span class="menu-text">Integrações</span>
                    </a>
                    <a class="bt_menu" data-roles="4,5,6,7,99" data-target=".painel_atestar">
                        <i class="fa-solid fa-calendar-days"></i>
                        <span class="menu-text">Atestar</span>
                    </a>
                    <div class="push"></div>

                    <a class="bt_menu" data-roles="5,6,7,99" data-target=".painel_vestimentas">
                        <i class="fa-solid fa-shirt"></i>
                        <span class="menu-text">Vestimentas (EPIs)</span>
                    </a>
                    <a class="bt_menu" data-roles="99" data-target=".painel_ferramentas" style="display: none;">
                        <i class="fa-solid fa-hammer"></i>
                        <span class="menu-text">Ferramentas</span>
                    </a>
                    <a class="bt_menu" data-roles="5,6,7,99" data-target=".painel_estatistica">
                        <i class="fa-solid fa-chart-simple"></i>
                        <span class="menu-text">Estatística</span>
                    </a>
                    <a class="bt_menu" data-roles="99" data-target=".painel_nivel">
                        <i class="fa-solid fa-chart-diagram"></i>
                        <span class="menu-text">Nível</span>
                    </a>
                    <a class="bt_menu" data-roles="*" data-target=".painel_senha">
                        <i class="fa-solid fa-lock"></i>
                        <span class="menu-text">Config. / Senha</span>
                    </a>
                    <a id="bt_sair_perfil" data-roles="*" class="bt_menu bt_sair" title="Fechar Dados">
                        <i class="fa-solid fa-person-walking-dashed-line-arrow-right"></i>
                        <span class="menu-text">Sair</span>
                    </a>
                </div>
                <div class="painel_Paineis">
                    <div class="painel_perfil">
                        <p>Dados Pessoal</p>
                        <div class="bt_foto">
                            <form id="form_foto" enctype="multipart/form-data">
                                <!-- input file escondido -->
                                <input type="file" id="select_foto" name="fotoperfil" accept="image/*"
                                    style="display:none;">
                                <!-- botão único -->
                                <button id="btn_upload" class="bt_teste glass" type="button">Carregar foto</button>
                            </form>
                        </div>
                        <form id="formColaborador" method="POST">
                            <div class="linha_infoColab linha_padrao">
                                <input id="nome" class="tbx_teste glass input_obrigatorio" type="text"
                                    placeholder="Nome Completo" name="nome" title="" required="required"
                                    style="width: 97%; text-align: left; padding-left: 10px;">
                                <div style="display: flex; justify-content: space-between;">
                                    <select id="sexo" class="cbx_teste glass info_padrao opcoes input_obrigatorio"
                                        name="genero" required="required" style="width: 150px;">
                                        <option value="" disabled selected hidden>Gênero...</option>
                                        <option value="1">Masculino</option>
                                        <option value="0">Feminino</option>
                                        <option value="2">Outro</option>
                                    </select>
                                    <div style="display: flex; align-items: center;">
                                        <p class="dataNasc">Data de Nascimento:</p>
                                        <input id="nascimento" class="tbx_teste glass" type="date" name="dataNascimento"
                                            title="" style="width: 140px;">
                                    </div>
                                </div>
                                <input id="endereco" class="tbx_teste glass" type="text" placeholder="Endereço"
                                    name="endereco" title="" style="width: 97%; text-align: left; padding-left: 10px;">
                            </div>
                            <div class="linha_contatoColab linha_padrao">
                                <input id="telefone" class="tbx_teste glass" type="text" name="telefone"
                                    placeholder="(00) 0 0000-0000">
                                <input id="mail" class="tbx_teste glass input_obrigatorio" type="email" name="email"
                                    placeholder="exemplo@email.com" autocomplete="off"
                                    style="text-align: left; padding-left: 10px;">
                                <div id="email-suggestions" class="email-suggestions" style="display: none;"></div>
                            </div>
                            <div class="linha_sobreMim linha_padrao">
                                <textarea id="sobremim" class="glass" name="sobre" placeholder="Sobre mim"
                                    style="width: 97%; height:50px; border-radius: 20px; padding: 4px; resize: none;"></textarea>
                            </div>
                            <div class="linha_Setor linha_padrao">
                                <div style="display: flex; align-items: center;">
                                    <p class="lblcpf">CPF:</p>
                                    <input id="cpf" class="tbx_teste glass input_obrigatorio input_cpf" type="text"
                                        placeholder="CPF" name="cpf" title="" maxlength="14">
                                    <p class="lblrg">RG:</p>
                                    <input id="rg" class="tbx_teste glass input_obrigatorio" type="text"
                                        placeholder="RG" name="rg" title="" maxlength="10">
                                </div>
                            </div>
                            <input type="hidden" name="idColaborador" id="idColaborador">
                            <div class="div_botoesAcao">
                                <input id="bt_cadColaborador" class="bt_padrao bt_cad" type="submit" name="cadColab"
                                    value="Cadastrar">
                                <input id="bt_editColab" class="bt_padrao bt_cad" type="submit" name="editColab"
                                    value="Salvar" style="display: none;">
                            </div>
                        </form>
                    </div>
                    <div class="painel_profissional">
                        <p>Dados Profissional</p>
                        <form id="formColaboradorProfissional" method="POST">
                            <div class="linha_infoColab linha_padrao">
                                <div class="painel_checkBokCNH">
                                    <p>Categoria CNH...</p>
                                    <input type="checkbox" id="cat_cnh_A" name="vehicle" value="A">
                                    <label for="cat_cnh_A">A</label><br>
                                    <input type="checkbox" id="cat_cnh_B" name="vehicle" value="B">
                                    <label for="cat_cnh_B">B</label><br>
                                    <input type="checkbox" id="cat_cnh_C" name="vehicle" value="C">
                                    <label for="cat_cnh_C">C</label><br>
                                    <input type="checkbox" id="cat_cnh_D" name="vehicle" value="D">
                                    <label for="cat_cnh_D">D</label><br>
                                    <!-- Campo oculto para armazenar os valores concatenados -->
                                    <input type="hidden" name="vehicles_selected" id="vehicles_selected">
                                </div>
                            </div>
                            <div class="linha_Setor linha_padrao">
                                <select id="empresacontrato"
                                    class="cbx_teste glass info_padrao opcoes input_obrigatorio" name="empresacontrato"
                                    required="required" style="width: 200px;">
                                    <option value="" disabled selected hidden>Empresa contratante...</option>
                                    <option value="RTW">RTW</option>
                                    <option value="V8i">V8i</option>
                                </select>
                            </div>

                            <div class="linha_Setor linha_padrao">
                                <select id="categoria" class="cbx_teste glass info_padrao opcoes input_obrigatorio"
                                    name="setor" required="required">
                                    <option value="" disabled selected hidden>Selecione o setor...</option>
                                    <option value="0">Estágio</option>
                                    <option value="1">Produção</option>
                                    <option value="2">Almoxarifado</option>
                                    <option value="4">Compras</option>
                                    <option value="5">Engenharia</option>
                                    <option value="6">Gerência</option>
                                    <option value="7">Financeiro</option>
                                    <option value="8">RH</option>
                                    <option value="9">Orçamento</option>
                                    <option value="10">Diretoria</option>
                                    <option value="12">Terceirizado</option>
                                </select>
                                <select id="cargo" class="cbx_teste glass info_padrao opcoes input_obrigatorio"
                                    name="cargo" required="required">
                                    <option value="" disabled selected hidden>Selecione o cargo...</option>
                                </select>
                            </div>
                            <input type="hidden" name="idColaboradorPro" id="idColaboradorPro">
                            <div class="div_botoesAcao">
                                <input id="bt_editColabProf" class="bt_padrao bt_cad" type="submit" name="editColabProf"
                                    value="Salvar">
                            </div>
                        </form>
                    </div>
                    <div class="painel_vestimentas">
                        <p>Vestimentas</p>
                        <div id="carregarEPIAqui" class="painel_epiGeral"
                            style="display: flex; justify-content: center;">

                        </div>
                        <div class="div_botoesAcao">
                            <input id="gerarFichaCompletaEPI" class="bt_padrao bt_buscar" type="button"
                                value="Gerar Ficha Completa">
                        </div>

                    </div>
                    <div class="painel_exames">
                        <p>Exames</p>
                        <div id="carregarExamesAqui" class="painel_vencimento_exames scroll-container">

                        </div>
                        <div class=" p_acoes linha_padrao">
                            <input type="button" id="bt_anexarExame_noPerfil" class="bt_teste glass" name="anexarExame"
                                value="Anexar Exame">
                        </div>
                    </div>
                    <div class="painel_cursos">
                        <p>Cursos</p>
                        <div id="carregarCursosAqui" class="painel_vencimento_cursos scroll-container">

                        </div>
                        <div class="p_acoes linha_padrao">
                            <input type="button" id="bt_anexarCurso_noPerfil" class="bt_teste glass" name="anexarCurso"
                                value="Anexar Curso">
                        </div>
                    </div>
                    <div class="painel_integra">
                        <p>Integração</p>
                        <div id="carregarIntegracoesAqui" class="painel_vencimento_integracoes scroll-container">

                        </div>
                    </div>
                    <div class="painel_atestar">
                        <p>Atestar Colaborador</p>
                        <form id="form_atestar" method="POST">
                            <div class="div_atestar">
                                <select id="motivo" class="cbx_teste glass info_padrao opcoes input_obrigatorio"
                                    name="atestado" required="required">
                                    <option value="" disabled selected hidden>Selecione o Atestado...</option>
                                    <option value="Ferias">Férias</option>
                                    <option value="Saude">Atestado Saúde</option>
                                    <option value="Paternidade">Licença Paternidade</option>
                                    <option value="Maternidade">Licença Maternidade</option>
                                    <option value="Afastamento">Afastamento</option>
                                </select>
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; gap:10px;">
                                    <div>
                                        <label for="datainicio">Data Inicial</label>
                                        <input id="datainicio" class="tbx_teste glass" type="date" name="periodoinicial"
                                            title="" style="width: 120px;">
                                    </div>
                                    <div>
                                        <label for="datafinal">Data Final</label>
                                        <input id="datafinal" class="tbx_teste glass" type="date" name="periodofinal"
                                            title="" style="width: 120px;">
                                    </div>
                                </div>
                            </div>
                            <textarea id="descricao" class="tbx_teste glass" name="descricaoatest"
                                placeholder="Descreva algo, se necessário"
                                style="width: auto; padding: 4px; resize: none;"></textarea>
                            <div class="p_acoes p_padrao linha_padrao">
                                <input class="bt_teste glass" type="submit" name="salvarAtestado" value="Salvar">
                            </div>
                            <input id="id" type="hidden" name="idColab" value="">
                        </form>
                        <h4>Historico de Licenças</h4>
                        <div class="tb_padraoGeral">
                            <table id="tb_historico_atestar" class="linha_padrao tb_zebrada">
                                <thead class="tb_padrao_conteudo">
                                    <tr class="rh_tb_lin_colob">
                                        <th style="display:none;">ID</th>
                                        <th>Motivo</th>
                                        <th>Data Inicio</th>
                                        <th>Data Final</th>
                                        <th>Descrição</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody class="tb_padrao_conteudo">
                                    <!-- Linhas serão adicionadas via JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="painel_estatistica">
                        <div class="indiceQtdeCliente">
                            <p>Historico de Participações por Cliente</p>
                            <div id="areaGraficoHist"></div>
                        </div>
                        <div class="painelLiberarAcessos" style="display: none;">
                            <p>Liberar Acessos</p>
                            <div class="LiberarAcessos">
                                <div class="blocoroigem">
                                    <div id="origem" class="bloco origem" data-id="230701">Guilherme S.</div>
                                </div>
                                <div class="blocos">
                                    <div class="bloco destino" id="dest1" data-nivel="0">Home</div>
                                    <div class="bloco destino" id="dest2" data-nivel="1">Programação</div>
                                    <div class="bloco destino" id="dest3" data-nivel="2">Projetos</div>
                                    <div class="bloco destino" id="dest4" data-nivel="3">Recursos Humanos</div>
                                    <div class="bloco destino" id="dest5" data-nivel="4">Administrativo</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="painel_nivel">
                        <p>Status</p>

                    </div>
                    <div class="painel_ferramentas">
                        <p>Ferramentas</p>
                        <div id="maleta-container">
                            <svg width="328" height="231" viewBox="0 0 328 231" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <g id="maleta">
                                    <g id="alca">
                                        <path id="ret" d="M0 16H6.15047V66H0V16Z" fill="#CE673A" />
                                        <rect id="ret_2" x="17.4263" width="292.147" height="6" fill="#CE673A" />
                                        <path id="Ellipse 7"
                                            d="M17.4263 0C15.1379 -2.6622e-08 12.8718 0.439718 10.7576 1.29405C8.6433 2.14838 6.72224 3.40059 5.10405 4.97919C3.48587 6.55778 2.20225 8.43185 1.3265 10.4944C0.450745 12.5569 -3.45547e-07 14.7675 0 17L6.12116 17C6.12116 15.5517 6.41358 14.1176 6.98171 12.7795C7.54985 11.4415 8.38258 10.2257 9.43237 9.20161C10.4821 8.17751 11.7284 7.36515 13.1 6.81091C14.4716 6.25667 15.9417 5.97141 17.4263 5.97141L17.4263 0Z"
                                            fill="#CE673A" />
                                        <path id="Ellipse 8"
                                            d="M309.574 0C311.862 -2.6622e-08 314.128 0.439718 316.242 1.29405C318.357 2.14838 320.278 3.40059 321.896 4.97919C323.514 6.55778 324.798 8.43185 325.674 10.4944C326.549 12.5569 327 14.7675 327 17L320.849 17C320.849 15.5555 320.557 14.1252 319.991 12.7907C319.424 11.4562 318.593 10.2437 317.546 9.2223C316.499 8.20091 315.256 7.39071 313.888 6.83794C312.521 6.28517 311.054 6.00067 309.574 6.00067L309.574 0Z"
                                            fill="#CE673A" />
                                        <path id="ret_3" d="M320.85 17H327V66H320.85V17Z" fill="#CE673A" />
                                    </g>
                                    <g id="tool-serrinha-de-corte" data-tool data-nome="Serrinha de Corte"
                                        data-entrega="01/02/2025" data-vistoria="SIM" data-ativo="true">
                                        <rect id="Rectangle 82" x="59.8114" y="149.682" width="178.535" height="9.50375"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 83" x="46.2513" y="200.819" width="171.877" height="6.10956"
                                            transform="rotate(0.291676 46.2513 200.819)" fill="#D9D9D9" />
                                        <rect id="Rectangle 84" x="216.643" y="202.631" width="22.0514" height="3.95874"
                                            transform="rotate(0.291676 216.643 202.631)" fill="#D9D9D9" />
                                        <rect id="Rectangle 85" x="234.952" y="203.245" width="7.16097" height="3.04504"
                                            rx="1.52252" transform="rotate(-57.5788 234.952 203.245)" fill="#D9D9D9" />
                                        <rect id="Rectangle 86" x="237.518" y="203.31" width="7.16097" height="3.04504"
                                            rx="1.52252" transform="rotate(38.2964 237.518 203.31)" fill="#D9D9D9" />
                                        <rect id="Rectangle 87" x="222.709" y="158.703" width="9.36606" height="49.5576"
                                            transform="rotate(-3.68169 222.709 158.703)" fill="#D9D9D9" />
                                        <rect id="Rectangle 88" x="37.162" y="167.309" width="9.64272" height="39.2662"
                                            transform="rotate(5.07666 37.162 167.309)" fill="#D9D9D9" />
                                        <path id="Rectangle 89"
                                            d="M34.8895 192.772L37.6102 193.601L33.7207 206.378V206.378C32.2181 205.92 31.3708 204.331 31.8282 202.829L34.8895 192.772Z"
                                            fill="#D9D9D9" />
                                        <path id="Ellipse 9"
                                            d="M61.7961 149.621C56.1702 149.234 50.5917 150.871 46.0707 154.237C41.5497 157.602 38.3851 162.474 37.1499 167.969L46.5001 170.067C47.2337 166.803 49.1134 163.91 51.7986 161.911C54.4838 159.912 57.7972 158.939 61.1387 159.169L61.7961 149.621Z"
                                            fill="#D9D9D9" />
                                        <path id="Ellipse 10"
                                            d="M208.262 149.945C213.888 149.558 219.467 151.195 223.988 154.561C228.509 157.927 231.674 162.798 232.909 168.293L223.766 170.344C223.021 167.031 221.113 164.094 218.387 162.064C215.661 160.035 212.298 159.048 208.905 159.281L208.262 149.945Z"
                                            fill="#D9D9D9" />
                                        <path id="Ellipse 11"
                                            d="M235.921 153.815C230.732 156.024 226.508 160.018 224.013 165.071L232.418 169.21C233.922 166.163 236.469 163.755 239.598 162.423L235.921 153.815Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 90"
                                            d="M237.667 149.003H255.463C259.881 149.003 263.463 152.585 263.463 157.003V163.259H237.667V149.003Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 91"
                                            d="M259.495 152.193L282.127 184.38C287.58 192.134 285.714 202.84 277.96 208.293V208.293L245.455 162.066L259.495 152.193Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 92"
                                            d="M257.97 164.279L263.567 183.031L255.394 185.47L249.797 166.719L257.97 164.279Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 93"
                                            d="M262.059 179.788L278.538 199.495L271.895 205.05L255.415 185.344L262.059 179.788Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 94"
                                            d="M278.398 199.916L278.398 206.42C278.398 208.077 277.055 209.42 275.398 209.42L274.215 209.42C270.901 209.42 268.215 206.733 268.215 203.42L268.215 199.916L278.398 199.916Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 95" x="42.8404" y="202.631" width="4.07304" height="2.71536"
                                            fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-chave-fenda" data-tool data-nome="Chave de Fenda"
                                        data-entrega="01/02/2025" data-vistoria="SIM" data-ativo="true">
                                        <path id="Rectangle 2"
                                            d="M163 154C163 153.448 163.448 153 164 153H177C177.552 153 178 153.448 178 154V209.5C178 213.642 174.642 217 170.5 217V217C166.358 217 163 213.642 163 209.5V154Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 3"
                                            d="M168 63C168 62.4477 168.448 62 169 62H171C171.552 62 172 62.4477 172 63V153H168V63Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 4"
                                            d="M167 53H173V61C173 62.1046 172.105 63 171 63H169C167.895 63 167 62.1046 167 61V53Z"
                                            fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-chave-philips" data-tool data-nome="Chave Philips"
                                        data-entrega="01/02/2025" data-vistoria="SIM" data-ativo="true">
                                        <path id="Rectangle 2_2"
                                            d="M138 150C138 149.448 138.448 149 139 149H152C152.552 149 153 149.448 153 150V205.5C153 209.642 149.642 213 145.5 213V213C141.358 213 138 209.642 138 205.5V150Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 3_2"
                                            d="M143 59C143 58.4477 143.448 58 144 58H146C146.552 58 147 58.4477 147 59V149H143V59Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 4_2"
                                            d="M142 53C142 52.4477 142.448 52 143 52H147C147.552 52 148 52.4477 148 53V57C148 58.1046 147.105 59 146 59H144C142.895 59 142 58.1046 142 57V53Z"
                                            fill="#D9D9D9" />
                                        <path id="Polygon 3"
                                            d="M144.134 48.5C144.519 47.8333 145.481 47.8333 145.866 48.5L147.598 51.5C147.983 52.1667 147.502 53 146.732 53H143.268C142.498 53 142.017 52.1667 142.402 51.5L144.134 48.5Z"
                                            fill="#D9D9D9" />
                                        <g id="tool-chave-philips_2">
                                            <path id="Rectangle 2_3"
                                                d="M158.536 158.897C158.6 158.349 159.097 157.956 159.646 158.02L169.787 159.208C170.336 159.273 170.728 159.769 170.664 160.318L165.019 208.509C164.626 211.858 161.593 214.255 158.244 213.863V213.863C154.895 213.47 152.499 210.437 152.891 207.089L158.536 158.897Z"
                                                fill="#D9D9D9" />
                                            <path id="Rectangle 3_3"
                                                d="M170.342 97.7275C170.406 97.1789 170.903 96.7864 171.451 96.8506L172.48 96.9712C173.029 97.0354 173.421 97.5322 173.357 98.0807L165.437 165.691L162.421 165.337L170.342 97.7275Z"
                                                fill="#D9D9D9" />
                                            <path id="Rectangle 4_3"
                                                d="M170.118 93.1159C170.182 92.5673 170.679 92.1747 171.227 92.239L173.764 92.5362C174.313 92.6004 174.705 93.0972 174.641 93.6457L174.372 95.9433C174.243 97.0404 173.25 97.8255 172.153 97.697L171.602 97.6325C170.505 97.504 169.72 96.5105 169.848 95.4134L170.118 93.1159Z"
                                                fill="#D9D9D9" />
                                            <path id="Polygon 3_2"
                                                d="M171.902 90.0072C172.362 89.3899 173.318 89.5018 173.623 90.2088L174.333 91.8568C174.638 92.5637 174.063 93.3354 173.298 93.2459L171.516 93.0371C170.751 92.9475 170.371 92.0639 170.83 91.4465L171.902 90.0072Z"
                                                fill="#D9D9D9" />
                                        </g>
                                        <g id="tool-chave-philips_3">
                                            <path id="Rectangle 2_4"
                                                d="M174.946 169.129C175.063 168.589 175.595 168.246 176.135 168.363L184.549 170.184C185.089 170.301 185.432 170.833 185.315 171.373L176.491 212.151C175.872 215.014 173.048 216.833 170.185 216.213V216.213C167.321 215.594 165.502 212.77 166.122 209.907L174.946 169.129Z"
                                                fill="#D9D9D9" />
                                            <path id="Rectangle 3_4"
                                                d="M187.19 129.923C187.306 129.384 187.839 129.041 188.379 129.157L188.667 129.22C189.207 129.337 189.55 129.869 189.433 130.409L178.601 180.463L176.358 179.978L187.19 129.923Z"
                                                fill="#D9D9D9" />
                                            <path id="Rectangle 4_4"
                                                d="M187.357 126.437C187.474 125.897 188.006 125.555 188.546 125.671L189.956 125.976C190.496 126.093 190.838 126.626 190.722 127.165L190.448 128.431C190.247 129.36 189.331 129.95 188.401 129.749V129.749C187.472 129.548 186.882 128.632 187.083 127.703L187.357 126.437Z"
                                                fill="#D9D9D9" />
                                            <path id="Polygon 3_3"
                                                d="M188.694 124.303C189.211 123.733 190.152 123.936 190.387 124.669L190.543 125.156C190.778 125.889 190.132 126.602 189.379 126.439L188.88 126.331C188.127 126.168 187.833 125.252 188.35 124.681L188.694 124.303Z"
                                                fill="#D9D9D9" />
                                        </g>
                                    </g>
                                    <g id="tool-multimetro" data-tool data-nome="Multimetro" data-entrega="01/02/2025"
                                        data-vistoria="SIM" data-ativo="true">
                                        <rect id="Rectangle 11" x="143.564" y="114.335" width="58.6047" height="102.558"
                                            rx="5" fill="#D9D9D9" />
                                        <rect id="Rectangle 12" x="148.448" y="119.218" width="48.8372" height="29.3023"
                                            rx="2" fill="#202020" />
                                        <circle id="Ellipse 2" cx="172.866" cy="187.591" r="19.5349" fill="white" />
                                        <line id="Line 4" x1="141.093" y1="217.235" x2="121.558" y2="148.863"
                                            stroke="white" stroke-width="3" />
                                        <line id="Line 5" x1="142.077" y1="192.672" x2="132.31" y2="119.414"
                                            stroke="white" stroke-width="3" />
                                        <path id="Polygon 1"
                                            d="M119.023 140.908L126.372 149.983L117.671 152.507L119.023 140.908Z"
                                            fill="#D9D9D9" />
                                        <path id="Polygon 2"
                                            d="M130.983 110.718L137.01 120.761L127.855 122.005L130.983 110.718Z"
                                            fill="#D9D9D9" />
                                        <path id="Vector 1"
                                            d="M141 216.951C150 226.451 156 228.451 156.5 228.451C157 228.451 163.5 226.951 164 226.451C164.4 226.051 168.833 223.951 171 222.951L173.5 218.951V216.951"
                                            stroke="white" stroke-width="2" />
                                        <path id="Vector 2"
                                            d="M142 192.451L143.527 203.644L151.164 215.855L156.764 221.451C158.461 221.451 162.058 221.451 162.873 221.451C163.687 221.451 166.945 220.773 168.473 220.434L170 217.381V216.872"
                                            stroke="white" stroke-width="2" />
                                    </g>
                                    <g id="tool-alicate-universal" data-tool data-entrega="01/02/2025"
                                        data-vistoria="SIM" data-nome="Alicate Universal" data-ativo="true">
                                        <rect id="Rectangle 13" x="160" y="96" width="22" height="22" fill="#D9D9D9" />
                                        <rect id="Rectangle 19" x="161" y="118" width="20" height="5" fill="#D9D9D9" />
                                        <rect id="Rectangle 20" x="159" y="122" width="24" height="10" fill="#D9D9D9" />
                                        <path id="Rectangle 24"
                                            d="M154.663 135.289L148.573 132.792C147.704 132.436 147.289 131.442 147.645 130.573V130.573C148.002 129.704 148.995 129.289 149.864 129.645L155.953 132.143L154.663 135.289Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 21" x="157.651" y="127.043" width="14.0755" height="27.5464"
                                            transform="rotate(23.7257 157.651 127.043)" fill="#D9D9D9" />
                                        <rect id="Rectangle 27" x="146.667" y="152" width="14.0755" height="25.4628"
                                            transform="rotate(5.94365 146.667 152)" fill="#D9D9D9" />
                                        <rect id="Rectangle 28" x="144" y="176.632" width="14.0755" height="25.4628"
                                            transform="rotate(-14.954 144 176.632)" fill="#D9D9D9" />
                                        <path id="Rectangle 29"
                                            d="M150 197.19L164.074 197L164.297 213.53C164.327 215.739 162.561 217.554 160.352 217.584L154.277 217.666C152.068 217.696 150.253 215.929 150.223 213.72L150 197.19Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 30" width="14.0755" height="25.4628"
                                            transform="matrix(-0.994624 0.10355 0.10355 0.994624 195.684 152)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 31" width="14.0755" height="25.4628"
                                            transform="matrix(-0.966134 -0.258043 -0.258043 0.966134 198.351 176.632)"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 32"
                                            d="M192.351 197.19L178.277 197L178.054 213.53C178.024 215.739 179.791 217.554 182 217.584L188.075 217.666C190.284 217.696 192.098 215.929 192.128 213.72L192.351 197.19Z"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 25"
                                            d="M187.874 135.247L193.964 132.749C194.833 132.393 195.248 131.4 194.892 130.531V130.531C194.536 129.662 193.542 129.246 192.673 129.603L186.584 132.1L187.874 135.247Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 26" width="14.0755" height="27.5464"
                                            transform="matrix(-0.915482 0.402359 0.402359 0.915482 184.886 127)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 16" x="166" y="79" width="10" height="17" fill="#D9D9D9" />
                                        <rect id="Rectangle 17" x="166.196" y="79.321" width="10.385" height="24.2687"
                                            transform="rotate(21.8903 166.196 79.321)" fill="#D9D9D9" />
                                        <rect id="Rectangle 18" x="166" y="83.9194" width="10.7561" height="23.9453"
                                            transform="rotate(-23.075 166 83.9194)" fill="#D9D9D9" />
                                        <rect id="Rectangle 14" x="157" y="101.808" width="6" height="16"
                                            transform="rotate(-7.74136 157 101.808)" fill="#D9D9D9" />
                                        <rect id="Rectangle 15" x="178.989" y="101" width="6.1877" height="16.5307"
                                            transform="rotate(7.14005 178.989 101)" fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-alicate-de-corte" data-tool data-entrega="01/02/2025"
                                        data-vistoria="SIM" data-nome="Alicate de Corte" data-ativo="true">
                                        <rect id="Rectangle 60" x="152.163" y="111" width="11.1621" height="22.9929"
                                            transform="rotate(7.95809 152.163 111)" fill="#D9D9D9" />
                                        <rect id="Rectangle 66" x="155.044" y="100.686" width="8.12708" height="11.0123"
                                            transform="rotate(7.95809 155.044 100.686)" fill="#D9D9D9" />
                                        <rect id="Rectangle 67" x="153.471" y="102.44" width="1.54513" height="8.88148"
                                            transform="rotate(-1.17166 153.471 102.44)" fill="#D9D9D9" />
                                        <rect id="Rectangle 68" x="154.571" y="94.7875" width="16.744" height="9.03467"
                                            transform="rotate(0.554173 154.571 94.7875)" fill="#D9D9D9" />
                                        <rect id="Rectangle 69" x="152.987" y="86.101" width="20.1859" height="10.449"
                                            transform="rotate(-0.0294746 152.987 86.101)" fill="#D9D9D9" />
                                        <rect id="Rectangle 65" x="141.661" y="118.578" width="12.9897" height="6.36475"
                                            rx="2.59939" transform="rotate(5.96091 141.661 118.578)" fill="#D9D9D9" />
                                        <rect id="Rectangle 71" x="143.063" y="123.494" width="7.85379" height="1.57014"
                                            transform="rotate(15.463 143.063 123.494)" fill="#D9D9D9" />
                                        <rect id="Rectangle 61" x="149.129" y="132" width="10.6304" height="22.9929"
                                            transform="rotate(10.5558 149.129 132)" fill="#D9D9D9" />
                                        <rect id="Rectangle 62" x="144.824" y="154.391" width="10.556" height="23.6137"
                                            transform="rotate(5.83463 144.824 154.391)" fill="#D9D9D9" />
                                        <rect id="Rectangle 63" x="142.345" y="177.578" width="10.3695" height="17.0119"
                                            transform="rotate(-3.86619 142.345 177.578)" fill="#D9D9D9" />
                                        <rect id="Rectangle 64" x="142.917" y="189.731" width="10.3695" height="22.9929"
                                            rx="4" transform="rotate(-9.60905 142.917 189.731)" fill="#D9D9D9" />
                                        <ellipse id="Ellipse 6" cx="162.917" cy="84.5" rx="7" ry="10.5"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 70"
                                            d="M156.891 78.2925C157.588 76.8853 159.294 76.3098 160.701 77.007V77.007L155.605 87.2923L153.057 86.0299L156.891 78.2925Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 72" width="11.1621" height="22.9929"
                                            transform="matrix(-0.99037 0.138449 0.138449 0.99037 173.971 111.255)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 73" width="8.12708" height="11.0123"
                                            transform="matrix(-0.99037 0.138449 0.138449 0.99037 171.09 100.942)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 74" width="1.54513" height="8.88148"
                                            transform="matrix(-0.999791 -0.020448 -0.020448 0.999791 172.662 102.696)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 75" width="12.9897" height="6.36475" rx="2.59939"
                                            transform="matrix(-0.994593 0.10385 0.10385 0.994593 184.473 118.833)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 76" width="7.85379" height="1.57014"
                                            transform="matrix(-0.963803 0.266617 0.266617 0.963803 183.071 123.75)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 77" width="10.6304" height="22.9929"
                                            transform="matrix(-0.983077 0.183192 0.183192 0.983077 177.005 132.255)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 78" width="10.556" height="23.6137"
                                            transform="matrix(-0.994819 0.101658 0.101658 0.994819 181.31 154.647)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 79" width="10.3695" height="17.0119"
                                            transform="matrix(-0.997724 -0.0674266 -0.0674266 0.997724 183.789 177.833)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 80" width="10.3695" height="22.9929" rx="4"
                                            transform="matrix(-0.98597 -0.166924 -0.166924 0.98597 183.217 189.986)"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 81"
                                            d="M169.243 78.5479C168.546 77.1407 166.84 76.5652 165.433 77.2624V77.2624L170.529 87.5478L173.077 86.2853L169.243 78.5479Z"
                                            fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-alicate-de-bico" data-tool data-entrega="01/02/2025" data-vistoria="SIM"
                                        data-nome="Alicate de Bico Fino" data-ativo="true">
                                        <rect id="Rectangle 96" x="151.579" y="151" width="10" height="9"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 106" x="148.808" y="161.492" width="4.17598"
                                            height="0.978277" transform="rotate(25.5946 148.808 161.492)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 105" x="145.751" y="156.862" width="9.51372"
                                            height="5.20433" rx="2.60217" transform="rotate(7.61203 145.751 156.862)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 98" x="153.622" y="157.19" width="8.53353" height="18.4967"
                                            transform="rotate(19.4503 153.622 157.19)" fill="#D9D9D9" />
                                        <rect id="Rectangle 99" x="147.522" y="174.418" width="8.50017" height="7.60519"
                                            transform="rotate(20.0729 147.522 174.418)" fill="#D9D9D9" />
                                        <rect id="Rectangle 100" x="144.874" y="181.565" width="8.53905"
                                            height="2.91856" transform="rotate(14.9065 144.874 181.565)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 101" x="144.153" y="184.29" width="8.45075" height="7.05469"
                                            transform="rotate(7.41955 144.153 184.29)" fill="#D9D9D9" />
                                        <rect id="Rectangle 102" x="143.252" y="191.246" width="8.35342" height="10.519"
                                            transform="rotate(0.787635 143.252 191.246)" fill="#D9D9D9" />
                                        <rect id="Rectangle 103" x="143" y="201.673" width="8.13113" height="15.4988"
                                            transform="rotate(-15.271 143 201.673)" fill="#D9D9D9" />
                                        <path id="Rectangle 104"
                                            d="M147.078 215.858C147.04 215.307 147.455 214.829 148.006 214.79L154.938 214.306L155.114 216.826C155.229 218.479 153.983 219.912 152.33 220.028L148.391 220.303C147.84 220.341 147.362 219.926 147.324 219.375L147.078 215.858Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 97" x="152.215" y="149.317" width="5" height="2"
                                            transform="rotate(19.0026 152.215 149.317)" fill="#D9D9D9" />
                                        <rect id="Rectangle 107" width="10" height="9"
                                            transform="matrix(-1 0 0 1 173.669 151.683)" fill="#D9D9D9" />
                                        <rect id="Rectangle 118" width="13" height="25"
                                            transform="matrix(-1 0 0 1 169.579 127)" fill="#D9D9D9" />
                                        <rect id="Rectangle 119" width="3" height="22"
                                            transform="matrix(-1 0 0 1 164.579 98)" fill="#D9D9D9" />
                                        <rect id="Rectangle 120" width="2.78836" height="27.6523"
                                            transform="matrix(-0.983013 -0.183538 -0.183538 0.983013 164.437 100.554)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 121" x="161.71" y="98.6178" width="2.96318" height="29.5036"
                                            transform="rotate(-9.435 161.71 98.6178)" fill="#D9D9D9" />
                                        <rect id="Rectangle 108" width="4.17598" height="0.978277"
                                            transform="matrix(-0.901873 0.432 0.432 0.901873 176.44 162.175)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 109" width="9.51372" height="5.20433" rx="2.60217"
                                            transform="matrix(-0.991188 0.132465 0.132465 0.991188 179.497 157.545)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 110" width="8.53353" height="18.4967"
                                            transform="matrix(-0.94293 0.33299 0.33299 0.94293 171.626 157.873)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 111" width="8.50017" height="7.60519"
                                            transform="matrix(-0.939256 0.343216 0.343216 0.939256 177.726 175.101)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 112" width="8.53905" height="2.91856"
                                            transform="matrix(-0.966347 0.257242 0.257242 0.966347 180.374 182.249)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 113" width="8.45075" height="7.05469"
                                            transform="matrix(-0.991627 0.129134 0.129134 0.991627 181.095 184.974)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 114" width="8.35342" height="10.519"
                                            transform="matrix(-0.999905 0.0137464 0.0137464 0.999905 181.996 191.93)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 115" width="8.13113" height="15.4988"
                                            transform="matrix(-0.964691 -0.263384 -0.263384 0.964691 182.248 202.356)"
                                            fill="#D9D9D9" />
                                        <path id="Rectangle 116"
                                            d="M178.17 216.541C178.209 215.99 177.793 215.512 177.242 215.474L170.31 214.989L170.134 217.509C170.019 219.162 171.265 220.596 172.918 220.711L176.857 220.986C177.408 221.025 177.886 220.609 177.924 220.058L178.17 216.541Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 117" width="5" height="2"
                                            transform="matrix(-0.945504 0.32561 0.32561 0.945504 173.033 150)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 122" x="159.726" y="114.968" width="2.71769" height="13"
                                            transform="rotate(1.28863 159.726 114.968)" fill="#D9D9D9" />
                                        <rect id="Rectangle 123" x="163.453" y="115.886" width="3" height="12.1489"
                                            transform="rotate(-1.28266 163.453 115.886)" fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-chave-allen" data-tool data-nome="Chave Allen" data-entrega="01/02/2025"
                                        data-vistoria="NÃO" data-ativo="true">
                                        <g id="alien_8">
                                            <path id="Rectangle 33"
                                                d="M217.496 165.029L218.044 165.959C219.447 168.338 218.655 171.403 216.277 172.806L173.665 197.929L170.578 192.692L217.496 165.029Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36" x="174.715" y="188.337" width="8.1987"
                                                height="6.35572" rx="1" transform="rotate(59.4772 174.715 188.337)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37"
                                                d="M168.187 191.374C168.56 190.929 169.224 190.871 169.669 191.245L171.415 192.71L170.738 193.516L168.187 191.374V191.374Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34"
                                                d="M208.76 150.026L217.034 164.06C218.437 166.438 217.645 169.504 215.266 170.906L214.221 171.523L203.407 153.182L208.76 150.026Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35"
                                                d="M213.272 166.828L212.295 170.651L210.56 170.207L211.538 166.384L213.272 166.828Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4"
                                                d="M169.047 194.632C168.656 196.428 167.866 197.78 167.283 197.653C166.699 197.526 166.544 195.967 166.936 194.172C167.328 192.376 168.118 191.024 168.701 191.151C169.284 191.278 169.439 192.837 169.047 194.632ZM167.29 194.249C167.03 195.442 167.133 196.477 167.521 196.562C167.908 196.646 168.433 195.748 168.693 194.555C168.953 193.363 168.85 192.327 168.463 192.243C168.075 192.158 167.551 193.057 167.29 194.249Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_7">
                                            <path id="Rectangle 33_2"
                                                d="M195.229 150.826V150.826C197.3 152.465 197.649 155.472 196.01 157.542L169.423 191.122L165.675 188.154L195.229 150.826Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_2" x="168.472" y="183.329" width="6.35964"
                                                height="4.93006" rx="1" transform="rotate(38.3706 168.472 183.329)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_2"
                                                d="M164.596 187.35C164.742 186.924 165.206 186.696 165.633 186.842L167.305 187.415L167.041 188.187L164.596 187.35V187.35Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_2"
                                                d="M183.446 141.177L194.226 149.712C196.253 151.317 196.596 154.263 194.99 156.291V156.291L180.539 144.849L183.446 141.177Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_2"
                                                d="M193.056 152.592L193.52 156.51L191.743 156.721L191.278 152.802L193.056 152.592Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_2"
                                                d="M166.151 189.758C166.253 191.3 165.866 192.581 165.288 192.619C164.71 192.657 164.159 191.438 164.058 189.895C163.957 188.353 164.343 187.072 164.921 187.034C165.499 186.996 166.05 188.216 166.151 189.758ZM164.409 189.872C164.477 190.897 164.842 191.707 165.226 191.681C165.61 191.656 165.867 190.805 165.8 189.781C165.733 188.756 165.367 187.946 164.983 187.972C164.599 187.997 164.342 188.848 164.409 189.872Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_6">
                                            <path id="Rectangle 33_3"
                                                d="M176.923 148.291V148.291C178.806 149.142 179.643 151.358 178.793 153.241L163.183 187.81L159.773 186.27L176.923 148.291Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_3" x="161.284" y="181.282" width="5.14893"
                                                height="4.20173" rx="1" transform="rotate(24.3026 161.284 181.282)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_3"
                                                d="M158.478 185.619C158.497 185.395 158.694 185.229 158.918 185.248L161.088 185.431L161.053 185.837L158.478 185.619V185.619Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_3"
                                                d="M164.326 141.791L176.574 147.322C178.401 148.147 179.214 150.298 178.389 152.126V152.126L162.831 145.101L164.326 141.791Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_3"
                                                d="M175.873 149.233L177.276 152.921L175.603 153.558L174.2 149.87L175.873 149.233Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_3"
                                                d="M160.504 187.464C160.932 188.793 160.832 190.014 160.281 190.191C159.73 190.368 158.937 189.435 158.509 188.106C158.082 186.777 158.182 185.556 158.733 185.378C159.284 185.201 160.077 186.135 160.504 187.464ZM158.844 187.998C159.128 188.881 159.655 189.501 160.021 189.383C160.387 189.266 160.453 188.455 160.169 187.572C159.886 186.689 159.359 186.069 158.993 186.186C158.627 186.304 158.56 187.115 158.844 187.998Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_5">
                                            <path id="Rectangle 33_4"
                                                d="M157.737 145.803V145.803C159.448 145.918 160.743 147.398 160.628 149.11L158.091 187.004L154.991 186.796L157.737 145.803Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_4" x="154.493" y="180.397" width="4.73104"
                                                height="4.92936" rx="1" transform="rotate(3.83128 154.493 180.397)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_4"
                                                d="M152.915 186.139C152.855 185.923 152.981 185.698 153.197 185.638L155.294 185.051L155.404 185.442L152.915 186.139V186.139Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_4"
                                                d="M144.196 144.431L156.888 145.281C158.737 145.405 160.136 147.004 160.012 148.854V148.854L143.972 147.78L144.196 144.431Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_4"
                                                d="M157.022 146.489L159.626 149.454L158.282 150.635L155.677 147.671L157.022 146.489Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_4"
                                                d="M155.458 187.159C156.324 188.254 156.657 189.433 156.203 189.792C155.749 190.151 154.679 189.553 153.814 188.458C152.949 187.362 152.615 186.183 153.07 185.824C153.524 185.466 154.593 186.063 155.458 187.159ZM154.09 188.24C154.665 188.967 155.375 189.364 155.677 189.126C155.978 188.888 155.757 188.105 155.182 187.377C154.608 186.649 153.897 186.252 153.596 186.491C153.294 186.729 153.515 187.512 154.09 188.24Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_4">
                                            <path id="Rectangle 33_5"
                                                d="M139.16 150.021V150.021C140.535 149.638 141.96 150.443 142.343 151.818L152.483 188.256L149.993 188.949L139.16 150.021Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_5" x="146.992" y="183.3" width="4.65307"
                                                height="4.84812" rx="1" transform="rotate(-15.5511 146.992 183.3)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_5"
                                                d="M147.403 189.142C147.276 188.961 147.32 188.712 147.501 188.585L149.254 187.356L149.484 187.684L147.403 189.142V189.142Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_5"
                                                d="M125.819 153.719L138.577 150.169C139.943 149.789 141.359 150.588 141.739 151.954V151.954L126.507 156.193L125.819 153.719Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_5"
                                                d="M138.703 150.606L142.086 152.506L141.224 154.041L137.841 152.141L138.703 150.606Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_5"
                                                d="M150.095 189.258C151.255 189.992 151.949 190.977 151.645 191.458C151.341 191.939 150.153 191.734 148.993 191C147.833 190.266 147.139 189.281 147.443 188.8C147.748 188.319 148.935 188.524 150.095 189.258ZM149.178 190.708C149.949 191.195 150.738 191.332 150.94 191.012C151.142 190.693 150.681 190.038 149.91 189.551C149.139 189.063 148.351 188.927 148.149 189.246C147.947 189.566 148.407 190.22 149.178 190.708Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_3">
                                            <path id="Rectangle 33_6"
                                                d="M126.032 160.471V160.471C127.348 159.625 129.101 160.006 129.946 161.323L148.673 190.464L146.289 191.996L126.032 160.471Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_6" x="141.817" y="186.598" width="4.31511"
                                                height="5.88587" rx="1" transform="rotate(-32.7241 141.817 186.598)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_6"
                                                d="M144.411 192.642C144.249 192.517 144.22 192.284 144.345 192.122L145.563 190.553L145.856 190.78L144.411 192.642V192.642Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_6"
                                                d="M115.366 166.821L125.447 160.343C126.692 159.543 128.349 159.904 129.149 161.148V161.148L116.814 169.075L115.366 166.821Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_6"
                                                d="M125.835 160.896L129.354 161.653L129.01 163.249L125.492 162.492L125.835 160.896Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_6"
                                                d="M146.828 192.008C148.057 192.341 148.942 193.023 148.804 193.533C148.666 194.042 147.558 194.186 146.329 193.853C145.1 193.52 144.215 192.837 144.353 192.328C144.491 191.819 145.599 191.675 146.828 192.008ZM146.413 193.543C147.229 193.764 147.965 193.669 148.057 193.331C148.149 192.992 147.561 192.539 146.745 192.318C145.928 192.097 145.192 192.192 145.1 192.53C145.009 192.869 145.596 193.322 146.413 193.543Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_2">
                                            <path id="Rectangle 33_7"
                                                d="M113.786 176.422V176.422C114.327 175.591 115.439 175.355 116.27 175.896L145.025 194.601L144.046 196.106L113.786 176.422Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_7" x="138.128" y="192.925" width="2.89472"
                                                height="5.44566" rx="1" transform="rotate(-56.9557 138.128 192.925)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_7"
                                                d="M142.79 197.205C142.598 197.158 142.48 196.965 142.526 196.773L142.975 194.913L143.323 194.997L142.79 197.205V197.205Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_7"
                                                d="M107.065 186.005L112.888 177.054C113.49 176.129 114.726 175.867 115.651 176.469V176.469L108.739 187.094L107.065 186.005Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_7"
                                                d="M113.143 176.715L116.533 175.989L116.863 177.527L113.473 178.253L113.143 176.715Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_7"
                                                d="M144.663 195.692C145.874 195.498 146.921 195.748 147.001 196.25C147.081 196.752 146.165 197.316 144.953 197.51C143.742 197.703 142.695 197.453 142.615 196.951C142.534 196.449 143.451 195.885 144.663 195.692ZM144.904 197.205C145.709 197.076 146.318 196.701 146.265 196.368C146.211 196.034 145.516 195.868 144.711 195.997C143.907 196.125 143.298 196.5 143.351 196.834C143.404 197.167 144.1 197.333 144.904 197.205Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <g id="alien_1">
                                            <path id="Rectangle 33_8"
                                                d="M109.744 190.602V190.602C109.908 189.948 110.572 189.55 111.225 189.714L142.696 197.608L142.399 198.792L109.744 190.602Z"
                                                fill="#E8E8E8" />
                                            <rect id="Rectangle 36_8" width="2.97756" height="4.30853" rx="1"
                                                transform="matrix(0.343297 -0.939227 0.985507 0.169634 137.841 198.68)"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 37_8"
                                                d="M142.61 200.249C142.411 200.262 142.228 200.113 142.201 199.916L142.034 198.705L142.394 198.681L142.61 200.249V200.249Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 34_8"
                                                d="M107.034 200.658L109.483 190.893C109.66 190.187 110.377 189.758 111.083 189.935V189.935L108.313 200.979L107.034 200.658Z"
                                                fill="#E8E8E8" />
                                            <path id="Rectangle 35_8"
                                                d="M109.96 190.926L111.288 190.126L111.651 190.729L110.323 191.528L109.96 190.926Z"
                                                fill="#E8E8E8" />
                                            <path id="Ellipse 4_8"
                                                d="M143.903 198.835C144.997 198.435 146.08 198.363 146.321 198.674C146.563 198.985 145.872 199.562 144.778 199.962C143.684 200.362 142.601 200.434 142.359 200.123C142.117 199.811 142.809 199.235 143.903 198.835ZM144.631 199.773C145.358 199.507 145.817 199.124 145.656 198.917C145.496 198.71 144.776 198.758 144.05 199.024C143.323 199.29 142.864 199.673 143.024 199.879C143.185 200.086 143.904 200.038 144.631 199.773Z"
                                                fill="#E8E8E8" />
                                        </g>
                                        <path id="Ellipse 3"
                                            d="M171.456 201.715C171.456 209.482 165.16 215.779 157.393 215.779C149.625 215.779 143.329 209.482 143.329 201.715C143.329 193.948 149.625 187.651 157.393 187.651C165.16 187.651 171.456 193.948 171.456 201.715ZM144.145 201.715C144.145 209.032 150.076 214.963 157.393 214.963C164.709 214.963 170.64 209.032 170.64 201.715C170.64 194.399 164.709 188.467 157.393 188.467C150.076 188.467 144.145 194.399 144.145 201.715Z"
                                            fill="#D9D9D9" />
                                    </g>
                                    <g id="tool-chave-de-boca-combinada" data-tool data-nome="Chave de Boca Combinada"
                                        data-entrega="01/02/2025" data-vistoria="SIM" data-ativo="true">
                                        <rect id="Rectangle 38" x="121.1" y="128.503" width="9.82839" height="111.526"
                                            transform="rotate(-41.4496 121.1 128.503)" fill="#D9D9D9" />
                                        <rect id="Rectangle 39" x="191.34" y="208.014" width="1.41349" height="7.71179"
                                            transform="rotate(-28.031 191.34 208.014)" fill="#D9D9D9" />
                                        <rect id="Rectangle 40" x="205.54" y="205.575" width="1.53213" height="7.83319"
                                            transform="rotate(117.726 205.54 205.575)" fill="#D9D9D9" />
                                        <path id="Ellipse 5"
                                            d="M211.825 213.6C211.825 218.294 208.019 222.1 203.325 222.1C198.63 222.1 194.825 218.294 194.825 213.6C194.825 208.906 198.63 205.1 203.325 205.1C208.019 205.1 211.825 208.906 211.825 213.6ZM196.671 213.6C196.671 217.275 199.65 220.253 203.325 220.253C206.999 220.253 209.978 217.275 209.978 213.6C209.978 209.925 206.999 206.947 203.325 206.947C199.65 206.947 196.671 209.925 196.671 213.6Z"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 41" x="111.097" y="123.897" width="1.39309" height="10.3806"
                                            transform="rotate(-55.7407 111.097 123.897)" fill="#D9D9D9" />
                                        <rect id="Rectangle 42" x="119.915" y="130.895" width="14.6886" height="7.61558"
                                            transform="rotate(-55.7407 119.915 130.895)" fill="#D9D9D9" />
                                        <rect id="Rectangle 43" x="111.285" y="123.771" width="1.24327" height="9.5033"
                                            transform="rotate(-26.555 111.285 123.771)" fill="#D9D9D9" />
                                        <rect id="Rectangle 44" x="111" y="123.916" width="1.55376" height="8.73822"
                                            transform="rotate(-26.6683 111 123.916)" fill="#D9D9D9" />
                                        <rect id="Rectangle 45" x="112.702" y="126.127" width="2.08783" height="8.87613"
                                            transform="rotate(-51.6912 112.702 126.127)" fill="#D9D9D9" />
                                        <rect id="Rectangle 46" x="113.825" y="128.738" width="2.08783" height="8.87613"
                                            transform="rotate(-51.6912 113.825 128.738)" fill="#D9D9D9" />
                                        <rect id="Rectangle 47" x="114.853" y="131.703" width="2.04242" height="5.65048"
                                            transform="rotate(-51.6912 114.853 131.703)" fill="#D9D9D9" />
                                        <rect id="Rectangle 48" x="118.81" y="135.321" width="6.92819" height="9.73498"
                                            rx="1" transform="rotate(-85.4349 118.81 135.321)" fill="#D9D9D9" />
                                        <rect id="Rectangle 50" x="121.658" y="135.301" width="1.60788" height="9.73498"
                                            transform="rotate(-70.9921 121.658 135.301)" fill="#D9D9D9" />
                                        <rect id="Rectangle 49" x="119.133" y="129.736" width="2.25443" height="4.84999"
                                            transform="rotate(-101.405 119.133 129.736)" fill="#D9D9D9" />
                                        <rect id="Rectangle 51" width="1.39309" height="10.3806"
                                            transform="matrix(-0.542659 0.839953 0.839953 0.542659 119.581 112.115)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 52" width="1.24327" height="9.5033"
                                            transform="matrix(-0.0641691 0.997939 0.997939 0.0641691 119.539 112.337)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 53" width="1.57156" height="8.91493"
                                            transform="matrix(-0.0661422 0.99781 0.99781 0.0661422 119.562 112)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 54" width="2.08783" height="8.87613"
                                            transform="matrix(-0.481988 0.876178 0.876178 0.481988 122.26 112.726)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 55" width="2.08783" height="8.87613"
                                            transform="matrix(-0.481988 0.876178 0.876178 0.481988 125.102 112.746)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 56" width="2.04242" height="5.65048"
                                            transform="matrix(-0.481988 0.876178 0.876178 0.481988 128.233 112.541)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 57" width="6.45191" height="15.2951" rx="1"
                                            transform="matrix(-0.991199 0.132383 0.132383 0.991199 133.637 115.074)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 58" width="1.60788" height="7.12783"
                                            transform="matrix(-0.89586 0.444336 0.444336 0.89586 135.147 126.862)"
                                            fill="#D9D9D9" />
                                        <rect id="Rectangle 59" width="2.25443" height="4.84999"
                                            transform="matrix(-0.980025 0.198875 0.198875 0.980025 128.085 117.249)"
                                            fill="#D9D9D9" />
                                    </g>
                                    <rect id="corpo" y="84.4884" width="327.209" height="146.512" fill="#CE673A" />
                                    <path id="tampa"
                                        d="M0 49.8605C0 48.7559 0.895431 47.8605 2 47.8605H325.209C326.314 47.8605 327.209 48.7559 327.209 49.8605V84.4884H0V49.8605Z"
                                        fill="#303030" />
                                    <path id="tampa_2" d="M0 108.907H327.209V113.791H0V108.907Z" fill="#303030" />
                                    <path id="tampa_3" d="M0 138.209H327.209V143.093H0V138.209Z" fill="#303030" />

                                    <g id="alca_2">
                                        <path id="ret_4" d="M0 24H6.15047V74H0V24Z" fill="#CE673A" />
                                        <rect id="ret_5" x="17.4263" y="8" width="292.147" height="6" fill="#CE673A" />
                                        <path id="Ellipse 7_2"
                                            d="M17.4263 8C15.1379 8 12.8718 8.43972 10.7576 9.29405C8.6433 10.1484 6.72224 11.4006 5.10405 12.9792C3.48587 14.5578 2.20225 16.4318 1.3265 18.4944C0.450745 20.5569 -3.45547e-07 22.7675 0 25L6.12116 25C6.12116 23.5517 6.41358 22.1176 6.98171 20.7795C7.54985 19.4415 8.38258 18.2257 9.43237 17.2016C10.4821 16.1775 11.7284 15.3651 13.1 14.8109C14.4716 14.2567 15.9417 13.9714 17.4263 13.9714L17.4263 8Z"
                                            fill="#CE673A" />
                                        <path id="Ellipse 8_2"
                                            d="M309.574 8C311.862 8 314.128 8.43972 316.242 9.29405C318.357 10.1484 320.278 11.4006 321.896 12.9792C323.514 14.5578 324.798 16.4318 325.674 18.4944C326.549 20.5569 327 22.7675 327 25L320.849 25C320.849 23.5555 320.557 22.1252 319.991 20.7907C319.424 19.4562 318.593 18.2437 317.546 17.2223C316.499 16.2009 315.256 15.3907 313.888 14.8379C312.521 14.2852 311.054 14.0007 309.574 14.0007L309.574 8Z"
                                            fill="#CE673A" />
                                        <path id="ret_6" d="M320.85 25H327V74H320.85V25Z" fill="#CE673A" />
                                    </g>
                                </g>
                            </svg>
                        </div>
                        
                        <div id="painelFerramenta" class="painel-ferramenta">
                            <div class="painel-info">
                                <h3 id="painelNome"></h3>
                                <p><strong>Entregue:</strong> <span id="painelEntrega"></span></p>
                                <p><strong>Vistoriado?</strong> <span id="painelVistoria"></span></p>
                            </div>
                        </div>
                        <div id="tooltipFerramentas" class="tooltipFerramentas"></div>
                    </div>
                    <div class="painel_senha">
                        <form id="form_senha" autocomplete="off">
                            <div class="linha_padrao linha_senhas">

                                <!-- campo oculto para username (para evitar warning do navegador) -->
                                <input type="hidden" name="username" id="username" value="usuario_atual"
                                    autocomplete="username">

                                <div>
                                    <label for="senhaantiga">Antiga Senha</label>
                                    <div style="position: relative;">
                                        <input id="senhaantiga" class="tbx_pesquisarOS senha-input" type="password"
                                            name="senhaantiga" style="width: 150px;" autocomplete="current-password">
                                        <i class="fa-solid fa-eye toggle-senha" data-target="senhaantiga"></i>
                                    </div>
                                </div>

                                <div>
                                    <label for="novasenha">Nova Senha</label>
                                    <div style="position: relative;">
                                        <input id="novasenha" class="tbx_pesquisarOS senha-input" type="password"
                                            name="novasenha" style="width: 150px;" autocomplete="new-password">
                                        <i class="fa-solid fa-eye toggle-senha" data-target="novasenha"></i>
                                    </div>
                                    <!-- Barra de força -->
                                    <div id="passwordStrength"
                                        style="width:150px; height:6px; background:#ccc; border-radius:4px; margin-top:4px;">
                                        <div id="passwordBar"
                                            style="height:6px; width:0%; background:red; border-radius:4px;"></div>
                                    </div>
                                    <p id="passwordLabel" style="font-size:12px; margin:2px 0 10px 0; color:#888;"></p>
                                </div>


                                <div>
                                    <label for="confirmarnovasenha">Confirmar Nova Senha</label>
                                    <div style="position: relative;">
                                        <input id="confirmarnovasenha" class="tbx_pesquisarOS senha-input"
                                            type="password" name="confirmarnovasenha" style="width: 150px;"
                                            autocomplete="new-password">
                                        <i class="fa-solid fa-eye toggle-senha" data-target="confirmarnovasenha"></i>
                                    </div>
                                </div>

                            </div>

                            <div class="p_acoes p_padrao linha_padrao">
                                <input class="bt_padrao bt_cad" type="submit" value="Salvar">
                            </div>

                            <input type="hidden" name="idColab" id="idColab" value="">
                        </form>
                        <div class="div_botoesAcao">
                            <h3>Configurações Avançadas</h3><br>
                            <input id="bt_excluirConta" class="bt_padrao bt_cancel" type="submit" name="excluirConta"
                                value="‼️Excluir conta">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<div id="crop-modal" hidden>
    <div class="crop-panel">
        <div id="crop-area"></div>
        <div class="crop-ctrls">
            <button type="button" id="rotLeft" class="bt_teste glass">⟲</button>
            <button type="button" id="rotRight" class="bt_teste glass">⟳</button>
            <button type="button" id="btn_cancel_crop" class="bt_teste glass">Cancelar</button>
            <!-- NOVO: botão para salvar -->
            <button type="button" id="btn_save_crop" class="bt_teste glass">Salvar</button>
        </div>
    </div>
</div>

</div>





<script>

    if (!window.Toast) {
        window.Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000
        });
    }

    $(document).on("click", "#bt_sair_perfil", function () {
        $('#form_cadColab').empty();
    });
    $(document).on("click", "#gerarFichaCompletaEPI", function () {
        const idColaborador = $('#idColaborador').val();

        const link = document.createElement("a");
        link.href = `/api/epi/ficha-completa/${idColaborador}`;
        link.target = "_blank";
        link.click();

        Swal.fire({
            icon: "success",
            title: "Ficha EPI",
            text: "Ficha completa de Entrega gerada.",
            theme: "dark"
        });
    });


    $('#formColaborador').on('submit', function (e) {
        e.preventDefault();

        // Captura o botão que disparou o submit
        const botaoClicado = e.originalEvent.submitter?.name || '';

        // Serializa dados do form
        const formData = $(this).serialize();

        if (botaoClicado === 'cadColab') {
            // 🔹 Cadastrar
            $.ajax({
                url: '/api/colaboradores/cadastrar',
                type: 'POST',
                data: formData,
                dataType: 'json',
                success: function (res) {
                    if (res.sucesso) {
                        let msg = `Colaborador cadastrado com sucesso!`;
                        msg += `\n\nLogin: ${res.id}`;
                        msg += `\nSenha: ${res.senhaPadrao}`;
                        $('#idColaborador').val(res.id);
                        $('#idColaboradorPro').val(res.id);
                        Swal.fire({
                            icon: "success",
                            title: "Cadastrado",
                            theme: "dark",
                            text: msg
                        });
                        $('#bt_editColab').show();
                        $('#bt_cadColaborador').hide();
                        $('[data-target=".painel_profissional"]').show();
                    } else {
                        Toast.fire({
                            icon: "warning",
                            title: "Atenção",
                            theme: "dark",
                            text: res.mensagem
                        });
                    }
                },
                error: function (xhr) {
                    let mensagem = "Erro ao processar a solicitação.";

                    if (xhr.responseJSON?.mensagem) {
                        mensagem = xhr.responseJSON.mensagem;
                    }
                    else if (xhr.responseText) {
                        try {
                            const json = JSON.parse(xhr.responseText);
                            mensagem = json.mensagem || mensagem;
                        } catch (e) { }
                    }

                    // 🎯 Regras de negócio
                    const ehAviso =
                        mensagem.includes('CPF já cadastrado') ||
                        mensagem.includes('RG já cadastrado');

                    Toast.fire({
                        icon: ehAviso ? "warning" : "error",
                        title: ehAviso ? "Atenção" : "Erro",
                        theme: "dark",
                        text: mensagem
                    });
                }
            });
        } else if (botaoClicado === 'editColab') {
            const idColaborador = $('#idColaborador').val();

            $.ajax({
                url: `/api/colaboradores/editar/${idColaborador}`,
                type: 'PUT',
                data: formData,
                dataType: 'json',
                success: function (res) {
                    if (res.sucesso) {
                        Toast.fire({
                            icon: "success",
                            theme: 'dark',
                            text: 'Colaborador atualizado com sucesso!'
                        });
                    } else {
                        // 🔥 Detectar qual campo falta baseando-se na mensagem
                        destacarCampoQueFalta(res.mensagem);
                        Toast.fire({
                            icon: "warning",
                            theme: 'dark',
                            title: res.mensagem
                        });
                    }
                },
                error: function (xhr) {
                    const resp = xhr.responseJSON;

                    if (resp?.mensagem) {
                        destacarCampoQueFalta(resp.mensagem);
                    }
                    Toast.fire({
                        icon: "warning",
                        theme: 'dark',
                        title: resp?.mensagem || "Erro ao atualizar colaborador."
                    });
                }
            });
        }

    });


    function destacarCampoQueFalta(mensagem) {
        // Remove erros anteriores
        $('input').removeClass('input-erro');

        // 🔎 Verifica nome
        if (mensagem.toLowerCase().includes("nome")) {
            const inp = $('[name="nome"]');
            inp.addClass('input-erro').focus();
        }

        // 🔎 Verifica CPF
        if (mensagem.toLowerCase().includes("cpf")) {
            const inp = $('[name="cpf"]');
            inp.addClass('input-erro').focus();
        }
        // 🔎 Verifica E-mail
        if (mensagem.toLowerCase().includes("e-mail")) {
            const inp = $('[name="email"]');
            inp.addClass('input-erro').focus();
        }
    }

    function verificarForcaSenha(senha) {
        let score = 0;

        if (senha.length >= 6) score++;
        if (senha.length >= 10) score++;
        if (/[A-Z]/.test(senha)) score++;
        if (/[0-9]/.test(senha)) score++;
        if (/[^A-Za-z0-9]/.test(senha)) score++;

        return score;
    }

    $('#novasenha').on('input', function () {
        const senha = $(this).val();
        const score = verificarForcaSenha(senha);

        const bar = $('#passwordBar');
        const label = $('#passwordLabel');

        if (score == 0) {
            bar.css({ width: "1%", background: "blue" });
            label.text("Digite sua nova senha").css("color", '#3debf1');
        } else if (score == 1) {
            bar.css({ width: "25%", background: "red" });
            label.text("Senha fraca").css("color", "red");
        } else if (score == 2) {
            bar.css({ width: "50%", background: "orange" });
            label.text("Senha média").css("color", "orange");
        } else if (score >= 3) {
            bar.css({ width: "100%", background: "green" });
            label.text("Senha forte").css("color", "green");
        }
    });

    $('#form_senha').on('submit', function (e) {
        e.preventDefault();

        const idColab = $('#idColab').val();
        const senhaAntiga = $('#senhaantiga').val();
        const novaSenha = $('#novasenha').val();
        const confirmar = $('#confirmarnovasenha').val();

        if (novaSenha !== confirmar) {
            return Swal.fire({
                icon: "warning",
                title: "Atenção",
                text: "A confirmação da nova senha não confere.",
                theme: "dark"
            });
        }

        $.ajax({
            url: '/api/auth/alterar-senha',
            method: 'POST',
            data: {
                idColab,
                senhaAntiga,
                novaSenha
            },
            success: function (res) {
                if (res.sucesso) {
                    Swal.fire({
                        icon: "success",
                        title: "Senha alterada!",
                        text: "Sua senha foi atualizada com sucesso.",
                        theme: "dark"
                    });
                    $('#form_senha')[0].reset();
                    $('#passwordBar').css("width", "0%");
                    $('#passwordLabel').text("Senha fraca").css("color", "#888");
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "Erro",
                        text: res.mensagem,
                        theme: "dark"
                    });
                }
            },
            error: function (xhr) {
                let mensagem = "Erro ao processar a solicitação.";

                if (xhr.responseJSON && xhr.responseJSON.mensagem) {
                    mensagem = xhr.responseJSON.mensagem;
                }
                else if (xhr.responseText) {
                    try {
                        const json = JSON.parse(xhr.responseText);
                        mensagem = json.mensagem || mensagem;
                    } catch (e) {
                        // responseText não é JSON
                    }
                }

                Swal.fire({
                    icon: "error",
                    title: "Erro",
                    theme: "dark",
                    text: mensagem
                });
            }
        });
    });


    //SALVAR FOTO
    (function () {
        if (window.__avatarUploadInit) return;
        window.__avatarUploadInit = true;

        let croppie = null;

        function openCropModal() {
            document.getElementById('crop-modal').hidden = false;
            document.body.classList.add('modal-open');
            const el = document.getElementById('crop-area');
            if (croppie) { croppie.destroy(); croppie = null; }
            el.innerHTML = '';
            croppie = new Croppie(el, {
                viewport: { width: 220, height: 220, type: 'circle' },
                boundary: { width: 280, height: 280 },
                enableExif: true,
                enableZoom: true
            });
        }
        function closeCropModal() {
            document.getElementById('crop-modal').hidden = true;
            document.body.classList.remove('modal-open');
            if (croppie) { croppie.destroy(); croppie = null; }
            $('#select_foto').val('');
            $('#crop-area').empty();
        }

        // 1) Botão "Carregar..." -> abrir seletor
        $(document).on('click', '#btn_upload[type="button"]', function () {
            $('#select_foto').trigger('click');
        });

        // 2) Selecionar arquivo -> abrir modal e carregar imagem
        $(document).on('change', '#select_foto', function (e) {
            const file = e.target.files && e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (ev) {
                openCropModal();
                croppie.bind({ url: ev.target.result });
                // não mudar o #btn_upload; ele segue “Carregar...”
            };
            reader.readAsDataURL(file);
        });

        // 3) Controles do modal
        $(document).on('click', '#rotLeft', () => { if (croppie) croppie.rotate(-90); });
        $(document).on('click', '#rotRight', () => { if (croppie) croppie.rotate(90); });
        $(document).on('click', '#btn_cancel_crop', closeCropModal);

        // 4) SALVAR (dentro do modal)
        $(document).on('click', '#btn_save_crop', async function () {
            const userId = $('#idColaborador').val() || $('#form_atestar #id').val();
            if (!userId) { alert('ID do usuário não encontrado.'); return; }
            if (!$('#select_foto')[0].files.length) { alert('Selecione uma foto.'); return; }

            // feedback no botão
            const $btn = $(this);
            const prevText = $btn.text();
            $btn.prop('disabled', true).text('Enviando...');

            try {
                // 1) Obtém a imagem recortada em PNG
                const pngBlob = await croppie.result({
                    type: 'blob',
                    format: 'png',
                    size: 'viewport'
                });

                // 2) Converte PNG → WEBP usando Canvas (otimizado)
                const webpBlob = await new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;

                        const ctx = canvas.getContext('2d', { alpha: true });

                        // melhora a interpolação, evita serrilhado
                        ctx.imageSmoothingEnabled = true;
                        ctx.imageSmoothingQuality = "high";

                        ctx.drawImage(img, 0, 0);

                        // exporta com compressão otimizada
                        canvas.toBlob(
                            blob => resolve(blob),
                            'image/webp',
                            0.72 // qualidade ideal para avatar (70~75%)
                        );
                    };
                    img.onerror = reject;
                    img.src = URL.createObjectURL(pngBlob);
                });


                // FormData direto (não depende do <form> agora)
                const formData = new FormData();
                formData.append('fotoperfil', webpBlob, 'avatar.webp');
                formData.append('id', userId);

                const resp = await $.ajax({
                    url: '/api/colaboradores/upload-foto',
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false
                });

                $('#fotoavatar')
                    .attr('src', resp.novaFotoURL + '?t=' + Date.now())
                    .on('error', function () {
                        console.warn("⚠️ Imagem de perfil não encontrada, usando padrão.");
                        $(this).attr('src', '/imagens/user-default.webp');
                    });

                closeCropModal();
            } catch (err) {
                alert(err?.responseJSON?.error || err?.responseText || 'Erro no upload da foto');
            } finally {
                $btn.prop('disabled', false).text(prevText);
            }
        });
    })();


    cargosPorSetor = {
        "0": [
            { value: "0", label: "Estagiário" }
        ],
        "1": [
            { value: "1", label: "Auxiliar Eletricista" },
            { value: "2", label: "Eletricista Junior" },
            { value: "3", label: "Eletricista Junior I" },
            { value: "4", label: "Eletricista Junior II" },
            { value: "5", label: "Eletricista Pleno" },
            { value: "6", label: "Eletricista Pleno I" },
            { value: "7", label: "Eletricista Pleno II" },
            { value: "8", label: "Eletricista Sênior" },
            { value: "9", label: "Eletricista Sênior I" },
            { value: "10", label: "Eletricista Sênior II" },
            { value: "11", label: "Painelista" },
            { value: "12", label: "Supervisor de Manutenção Elétrica" },
            { value: "31", label: "Supervisor de Manutenção 2" },
            { value: "32", label: "Técnico de Segurança" },
            { value: "13", label: "Gerente de Produção" }
        ],
        "2": [
            { value: "19", label: "Estoquista" }
        ],
        "4": [
            { value: "20", label: "Comprador" }
        ],
        "5": [
            { value: "14", label: "Projetista Junior" },
            { value: "15", label: "Projetista Pleno" },
            { value: "16", label: "Projetista Senior" },
            { value: "17", label: "Engenheiro Eletricista" },
            { value: "18", label: "Gerente de Engenharia" }
        ],
        "6": [
            { value: "13", label: "Gerente de Produção" },
            { value: "18", label: "Gerente de Engenharia" },
            { value: "21", label: "Gerente Financeiro" }
        ],
        "7": [
            { value: "22", label: "Analista Financeiro" },
            { value: "23", label: "Assistente Financeiro" },
            { value: "30", label: "Auxiliar Fiscal" }
        ],
        "8": [
            { value: "24", label: "Assistente de RH" },
            { value: "25", label: "Analista de RH" }
        ],
        "9": [
            { value: "26", label: "Orçamentista" }
        ],
        "10": [
            { value: "27", label: "Diretor" }
        ],
        "12": [
            { value: "29", label: "Terceiro" }
        ]
    };


    $(function () {
        const $categoria = $("#categoria");
        const $cargo = $("#cargo");

        function preencherCargos(setor, manterValorSelecionado = false) {
            const placeholder = '<option value="" disabled selected hidden>Selecione o cargo...</option>';
            const valorAnterior = manterValorSelecionado ? $cargo.val() : "";

            const chave = String(setor).trim();
            const lista = cargosPorSetor[chave] || [];

            // Limpa e desabilita por padrão
            $cargo.html(placeholder).prop("disabled", true);

            if (!lista.length) {
                console.warn("[preencherCargos] Setor sem mapeamento ou vazio:", { setor, chave, lista });
                return; // fica só com placeholder e desabilitado
            }

            // Popula
            $.each(lista, function (i, item) {
                // Defesa contra itens malformados
                if (!item || typeof item.value === "undefined" || typeof item.label === "undefined") {
                    console.warn("[preencherCargos] Item inválido na lista:", item);
                    return;
                }
                $cargo.append($("<option>", { value: item.value, text: item.label }));
            });

            // Habilita
            $cargo.prop("disabled", false);

            // Restaura seleção, se válida
            if (manterValorSelecionado && valorAnterior) {
                const existe = $cargo.find("option[value='" + valorAnterior + "']").length > 0;
                if (existe) $cargo.val(valorAnterior);
            }
        }

        // Change de categoria
        $categoria.on("change", function () {
            const val = $(this).val();
            preencherCargos(val);
        });

        // Inicialização (se vier preenchido do servidor)
        if ($categoria.val()) {
            preencherCargos($categoria.val(), true);
        } else {
            // Garantir que cargo inicie desabilitado até escolher setor
            $cargo.prop("disabled", true);
        }
    });

    $(document).ready(function () {
        $("input[name='vehicle']").change(function () {
            // Pega todos os checkboxes marcados
            var selecionados = $("input[name='vehicle']:checked")
                .map(function () { return this.value; })
                .get()
                .join(",");

            // Joga para o campo oculto
            $("#vehicles_selected").val(selecionados);
        });
    });





    $('#checkColabDesligado').on('change', function () {
        const ligado = $(this).is(':checked');
        const userId = $('.painel_todos').find('#id').val();

        $.ajax({
            url: '/desligar_colab', // Substitua pelo seu backend
            method: 'POST',
            data: { status: ligado ? 'on' : 'off', userId },
            success: function (resposta) {

            },
            error: function (erro) {
                console.error('Erro na requisição:', erro);
            }
        });
    });




    // Controle dos botões do menu
    $('.bt_menu').on('click', function () {
        const target = $(this).data('target');

        $('.bt_menu').removeClass('ativo');
        $(this).addClass('ativo');

        // Se o painel for exames, chama a função
        if (target === '.painel_exames') {
            const idFunc = $('#idColaborador').val();
            load_exames_colaborador(idFunc, $('#carregarExamesAqui'));
        }

        // Se o painel for epi, chama a função
        if (target === '.painel_vestimentas') {
            const idFunc = $('#idColaborador').val();
            load_epis_colaborador(idFunc, $('#carregarEPIAqui'));
        }
        // Se o painel for cursos, chama a função
        if (target === '.painel_cursos') {
            const idFunc = $('#idColaborador').val();
            load_cursos_colaborador(idFunc, $('#carregarCursosAqui'));
        }
        // Se o painel for integracoes, chama a função
        if (target === '.painel_integra') {
            const idFunc = $('#idColaborador').val();
            load_integracoes_colaborador(idFunc, $('#carregarIntegracoesAqui'));

        }
        if (target === '.painel_senha') {
            const id = $('#idColaborador').val(); // ID que já existe nos outros painéis
            $('#idColab').val(id);
        }
        // Oculta todos os painéis
        $('.painel_perfil, .painel_profissional, .painel_vestimentas, .painel_exames, .painel_cursos, .painel_integra, .painel_atestar, .painel_nivel, .painel_estatistica, .painel_ferramentas, .painel_senha').hide();

        // Mostra o painel clicado
        $(target).fadeIn(200);
    });

    $(document).ready(function () {
        let grafico;
        const idFuncionario = $('.painel_todos').find('#id').val();
        if (idFuncionario == '') { return false };
        // Primeiro cria o canvas no DOM
        $('#areaGraficoHist').html('<canvas id="graficoHistClientes"></canvas>');

        // Só depois pega o contexto
        const ctx = document.getElementById('graficoHistClientes').getContext('2d');

        // Faz a requisição AJAX
        $.getJSON(`/api/colaboradores/historico-empresas/${idFuncionario}`, function (resposta) {
            const clientes = resposta.map(r => r.cliente);
            const quantidades = resposta.map(r => r.quantidade);
            const total = quantidades.reduce((soma, q) => soma + q, 0);

            if (window.graficoHistClientes instanceof Chart) {
                window.graficoHistClientes.destroy();
            }

            window.graficoHistClientes = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: clientes,
                    datasets: [{
                        label: 'Participações',
                        data: quantidades,
                        backgroundColor: 'rgba(75, 192, 75, 0.7)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false, // ← ESSENCIAL para permitir crescer em altura
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const valor = context.parsed.x;
                                    const perc = ((valor / total) * 100).toFixed(1);
                                    return `${valor} participações (${perc}%)`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: false,
                                text: 'Quantidade'
                            }
                        },
                        y: {
                            title: {
                                display: false,
                                text: 'Clientes'
                            }
                        }
                    }
                }
            });
        });
    });




</script>